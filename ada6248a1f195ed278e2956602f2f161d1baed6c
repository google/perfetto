Cherry-picked as 63f1ba4f684943307b6d99d0669b1d180bc3b6f5 (#1506)
