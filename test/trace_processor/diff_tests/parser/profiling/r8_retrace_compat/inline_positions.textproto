# Test data for MethodWithInlinePositionsStackSampleRetraceTest
#
# R8 mapping (what a real R8 build produces):
#   com.example.Main -> a:
#       1:1:void foo():54:54 -> a
#       1:1:void test():50 -> a
#       2:2:void bar():59:59 -> a
#       2:2:void foo():55 -> a
#       2:2:void test():50 -> a
#       3:3:void baz():64:64 -> a
#       3:3:void bar():60 -> a
#       3:3:void foo():55 -> a
#       3:3:void test():50 -> a
#
# This means:
#   - At obfuscated line 1: foo() was inlined into test()
#   - At obfuscated line 2: bar() was inlined into foo() which was inlined into test()
#   - At obfuscated line 3: baz() was inlined into bar() which was inlined into foo() which was inlined into test()
#
# Expected behavior: Given an obfuscated frame "a.a" at line 1, deobfuscation should
# produce inline chain entries in stack_profile_symbol.

packet {
  clock_snapshot {
    clocks: { clock_id: 6 timestamp: 0 }
    clocks: { clock_id: 4 timestamp: 10 }
  }
}
packet {
  process_tree {
    processes { pid: 1 ppid: 0 cmdline: "init" uid: 0 }
    processes { pid: 100 ppid: 1 cmdline: "com.example.app" uid: 10001 }
  }
}
packet {
  packages_list {
    packages { name: "com.example.app" uid: 10001 }
  }
}
packet {
  trusted_packet_sequence_id: 1
  previous_packet_dropped: true
  incremental_state_cleared: true
  timestamp: 100
  profile_packet {
    # Three frames at different addresses - line numbers come from symbolization
    strings { iid: 1 str: "a.a" }
    strings { iid: 2 str: "/data/app/com.example.app-abc123/base.apk" }
    strings { iid: 3 str: "abc123" }
    # Frame at address 0x1000 - will be symbolized with line 1
    frames { iid: 1 function_name_id: 1 mapping_id: 1 rel_pc: 0x1000 }
    # Frame at address 0x2000 - will be symbolized with line 2
    frames { iid: 2 function_name_id: 1 mapping_id: 1 rel_pc: 0x2000 }
    # Frame at address 0x3000 - will be symbolized with line 3
    frames { iid: 3 function_name_id: 1 mapping_id: 1 rel_pc: 0x3000 }
    callstacks { iid: 1 frame_ids: 1 }
    callstacks { iid: 2 frame_ids: 2 }
    callstacks { iid: 3 frame_ids: 3 }
    mappings { iid: 1 path_string_ids: 2 build_id: 3 }
    process_dumps {
      pid: 100
      samples { callstack_id: 1 self_allocated: 1000 alloc_count: 1 }
      samples { callstack_id: 2 self_allocated: 1000 alloc_count: 1 }
      samples { callstack_id: 3 self_allocated: 1000 alloc_count: 1 }
    }
  }
}
# Symbolization data - provides line numbers for each address
packet {
  module_symbols {
    path: "/data/app/com.example.app-abc123/base.apk"
    build_id: "abc123"
    # Address 0x1000 -> a.a at line 1
    address_symbols {
      address: 0x1000
      lines {
        function_name: "a.a"
        source_file_name: "Main.java"
        line_number: 1
      }
    }
    # Address 0x2000 -> a.a at line 2
    address_symbols {
      address: 0x2000
      lines {
        function_name: "a.a"
        source_file_name: "Main.java"
        line_number: 2
      }
    }
    # Address 0x3000 -> a.a at line 3
    address_symbols {
      address: 0x3000
      lines {
        function_name: "a.a"
        source_file_name: "Main.java"
        line_number: 3
      }
    }
  }
}
packet {
  deobfuscation_mapping {
    package_name: "com.example.app"
    version_code: 1
    obfuscated_classes {
      obfuscated_name: "a"
      deobfuscated_name: "com.example.Main"
      # R8 mapping: 1:1:void foo():54:54 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "foo"
        obfuscated_line_start: 1
        obfuscated_line_end: 1
        source_line_start: 54
      }
      # R8 mapping: 1:1:void test():50 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "test"
        obfuscated_line_start: 1
        obfuscated_line_end: 1
        source_line_start: 50
      }
      # R8 mapping: 2:2:void bar():59:59 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "bar"
        obfuscated_line_start: 2
        obfuscated_line_end: 2
        source_line_start: 59
      }
      # R8 mapping: 2:2:void foo():55 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "foo"
        obfuscated_line_start: 2
        obfuscated_line_end: 2
        source_line_start: 55
      }
      # R8 mapping: 2:2:void test():50 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "test"
        obfuscated_line_start: 2
        obfuscated_line_end: 2
        source_line_start: 50
      }
      # R8 mapping: 3:3:void baz():64:64 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "baz"
        obfuscated_line_start: 3
        obfuscated_line_end: 3
        source_line_start: 64
      }
      # R8 mapping: 3:3:void bar():60 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "bar"
        obfuscated_line_start: 3
        obfuscated_line_end: 3
        source_line_start: 60
      }
      # R8 mapping: 3:3:void foo():55 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "foo"
        obfuscated_line_start: 3
        obfuscated_line_end: 3
        source_line_start: 55
      }
      # R8 mapping: 3:3:void test():50 -> a
      obfuscated_methods {
        obfuscated_name: "a"
        deobfuscated_name: "test"
        obfuscated_line_start: 3
        obfuscated_line_end: 3
        source_line_start: 50
      }
    }
  }
}
