Cherry-picked as ddc1e69572fd460300c5e22080b2f64748b215e2 (#1380)
